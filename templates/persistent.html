<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Persistent Bluesky Bot</title>
<style>
  body {font-family: system-ui, Tahoma; background:#f3f6ff; color:#222; margin:0; padding:0;}
  .wrap {max-width: 900px; margin: 24px auto; padding: 0 16px;}
  .card {background:#fff; border-radius:14px; padding:18px 16px; margin:14px 0; box-shadow:0 8px 24px rgba(0,0,0,.06);}
  h1{font-size:32px; margin:0 0 8px;}
  input, select, textarea {width:100%; border:1px solid #ddd; border-radius:12px; padding:10px 12px; margin:8px 0 14px; font-size:16px;}
  textarea{min-height:100px}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .btn{display:inline-block; padding:10px 14px; border-radius:12px; border:0; cursor:pointer; font-size:16px}
  .btn-primary{background:#2563eb; color:#fff}
  .btn-warn{background:#ef4444; color:#fff}
  .btn-ghost{background:#f1f5f9}
  .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
  .stat{background:#fafafa;border:1px solid #eee;border-radius:12px;padding:12px;text-align:center}
  .muted{color:#667}
  .note{background:#e0f2fe; padding:10px 12px; border-radius:10px; border:1px solid #bae6fd}
</style>
</head>
<body>
<div class="wrap">

  <div class="card">
    <h1>Persistent Bluesky Bot ğŸ¤–</h1>
    <p class="muted">ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ© Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©. ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <b>App Password</b> Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Bluesky.</p>
  </div>

  <div class="card">
    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <div class="row">
      <div>
        <label>Ø­Ø³Ø§Ø¨ Ø¨Ù„ÙˆØ³ÙƒØ§ÙŠ (handle)</label>
        <input id="handle" placeholder="example.bsky.social" />
      </div>
      <div>
        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
        <input id="password" type="password" placeholder="App Password" />
      </div>
    </div>

    <h3>Ù‡Ø¯Ù Ø§Ù„Ù…Ù‡Ù…Ø©</h3>
    <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨ÙˆØ³Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
    <input id="post_url" placeholder="https://bsky.app/profile/xxx/post/xxxx" />

    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</label>
    <select id="processing_mode">
      <option value="LIKES">Ù…Ø¹Ø¬Ø¨ÙˆÙ† (Likes)</option>
      <option value="REPOSTS">Ù…Ø¹ÙŠØ¯Ùˆ Ù†Ø´Ø± (Reposts)</option>
    </select>

    <div class="row">
      <div>
        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ£Ø®ÙŠØ± (Ø«ÙˆØ§Ù†ÙŠ)</label>
        <input id="min_delay" type="number" value="200" />
      </div>
      <div>
        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ£Ø®ÙŠØ± (Ø«ÙˆØ§Ù†ÙŠ)</label>
        <input id="max_delay" type="number" value="250" />
      </div>
    </div>

    <label>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø³Ø·Ø± Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©ØŒ Ø³ÙŠÙØ®ØªØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…)</label>
    <textarea id="messages" placeholder="Message 1\nMessage 2\nMessage 3"></textarea>

    <div>
      <button class="btn btn-primary" onclick="startTask()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© âœ…</button>
      <button class="btn btn-warn" onclick="stopTask()">Ø¥ÙŠÙ‚Ø§Ù â›”</button>
      <button class="btn btn-ghost" onclick="refresh()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ğŸ”„</button>
    </div>
    <p class="note">ÙŠÙØ­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ù…Ù„Ù progress.json Ø­Ø³Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨/Ø§Ù„Ø±Ø§Ø¨Ø·.</p>
  </div>

  <div class="card">
    <h3>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</h3>
    <div class="grid">
      <div class="stat">
        <div class="muted">Ø§Ù„Ø­Ø§Ù„Ø©</div>
        <div id="st">â€”</div>
      </div>
      <div class="stat">
        <div class="muted">Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
        <div id="task">â€”</div>
      </div>
      <div class="stat">
        <div class="muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</div>
        <div id="total">0</div>
      </div>
      <div class="stat">
        <div class="muted">ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡</div>
        <div id="done">0</div>
      </div>
      <div class="stat">
        <div class="muted">ÙØ´Ù„</div>
        <div id="failed">0</div>
      </div>
      <div class="stat">
        <div class="muted">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</div>
        <div id="rate">0%</div>
      </div>
    </div>
  </div>

</div>

<script>
async function startTask(){
  const payload = {
    bluesky_handle: document.getElementById('handle').value.trim(),
    bluesky_password: document.getElementById('password').value.trim(),
    post_url: document.getElementById('post_url').value.trim(),
    processing_mode: document.getElementById('processing_mode').value,
    min_delay: parseInt(document.getElementById('min_delay').value || '200'),
    max_delay: parseInt(document.getElementById('max_delay').value || '250'),
    messages: (document.getElementById('messages').value || '')
                .split('\n').map(s => s.trim()).filter(Boolean),
  };
  const r = await fetch('/queue_task', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  const j = await r.json();
  alert(JSON.stringify(j));
  refresh();
}

async function stopTask(){
  await fetch('/stop_task', {method:'POST'});
  refresh();
}

async function refresh(){
  const r = await fetch('/detailed_progress');
  const j = await r.json();
  document.getElementById('st').innerText = j.runtime_stats.status;
  document.getElementById('task').innerText = j.runtime_stats.current_task || 'â€”';
  document.getElementById('total').innerText = j.bot_progress.total;
  document.getElementById('done').innerText = j.bot_progress.done;
  document.getElementById('failed').innerText = j.bot_progress.failed;
  document.getElementById('rate').innerText = ((j.bot_progress.success_rate*100)||0).toFixed(2)+'%';
}
refresh();
</script>
</body>
</html>
